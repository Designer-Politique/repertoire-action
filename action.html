<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Répertoire d'actions politiques</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="site-header">
    <img src="logo.png" alt="Logo">
    <h1>Répertoire d'actions politiques</h1>
  </header>



  <div class="filters">
    <label>Facilité:
      <select id="faciliteFilter"><option value="">Toutes</option><option>Facile</option><option>Moyen</option><option>Difficile</option></select>
    </label>
    <label>Échelle:
      <select id="echelleFilter"><option value="">Toutes</option><option>Individuel</option><option>Collectif</option></select>
    </label>
    <label>Rapidité:
      <select id="rapiditeFilter"><option value="">Toutes</option><option>Rapide</option><option>Moyen</option><option>Lent</option></select>
    </label>
  </div>

  <div id="actionsContainer" class="grid"></div>

  <!-- Si fetch échoue, le script ci-dessous lira ce JSON embarqué :
       Remplace le contenu du <script id="actions-data"> par ton JSON complet si tu veux -->
  <script id="actions-data" type="application/json">
  [
    { "id": 1, "titre": "Signer une pétition", "facilite": "Facile", "echelle": "Individuel", "rapidite": "Rapide", "description": "Signer une pétition en ligne ou papier pour montrer son soutien à une cause.", "liens": [] },
    { "id": 2, "titre": "Organiser une manifestation", "facilite": "Difficile", "echelle": "Collectif", "rapidite": "Lent", "description": "Planifier, déclarer en préfecture et mobiliser des personnes pour manifester.", "liens": [] }
  ]
  </script>

  <script>
    let actions = [];
    const filters = { facilite: "", echelle: "", rapidite: "" };

    async function loadActions() {
      // première tentative : fetch (fonctionne si tu sers les fichiers via http)
      try {
        const res = await fetch('actions.json');
        if (!res.ok) throw new Error('HTTP ' + res.status);
        actions = await res.json();
      } catch (err) {
        // fallback : lire le JSON embarqué dans la page
        console.warn('fetch failed — fallback to embedded JSON', err);
        const embed = document.getElementById('actions-data');
        try {
          actions = JSON.parse(embed.textContent);
        } catch (e) {
          console.error('embedded JSON parse error', e);
          actions = [];
        }
      }
      renderActions();
    }

    function renderActions() {
      const container = document.getElementById('actionsContainer');
      container.innerHTML = '';
      const filtered = actions.filter(a =>
        (filters.facilite === '' || a.facilite === filters.facilite) &&
        (filters.echelle === '' || a.echelle === filters.echelle) &&
        (filters.rapidite === '' || a.rapidite === filters.rapidite)
      );
      if (filtered.length === 0) {
        container.innerHTML = '<p style="color:gray;font-style:italic;">Aucune action trouvée avec ces filtres.</p>';
        return;
      }
      filtered.forEach(a => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div>
            <h2>${a.titre}</h2>
            <p>Facilité : ${a.facilite}</p>
            <p>Échelle : ${a.echelle}</p>
            <p>Rapidité : ${a.rapidite}</p>
          </div>
          <a class="btn" href="detail.html?id=${a.id}">Voir les détails</a>
        `;
        container.appendChild(card);
      });
    }

    document.getElementById('faciliteFilter').addEventListener('change', e => { filters.facilite = e.target.value; renderActions(); });
    document.getElementById('echelleFilter').addEventListener('change', e => { filters.echelle = e.target.value; renderActions(); });
    document.getElementById('rapiditeFilter').addEventListener('change', e => { filters.rapidite = e.target.value; renderActions(); });

    loadActions();
  </script>
</body>
</html>
